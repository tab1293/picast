<html>
<head>
    <title>Picast</title>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/jquery-fix.js"></script>
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/handlebars-v3.0.3.js"></script>
    <script id="videoTemplate" type="text/x-handlebars-template">
        <img id="{{path}}" class="poster" {{#if Poster}} src="{{Poster}}" {{else}} src="./img/no-poster.jpg" {{/if}}></img>
    </script>
    <script type="text/javascript">
        var remote = require('remote');
        var ipc = require('ipc');
        var Masonry = require('masonry-layout')
        var masonry;

        ipc.send('getPi');

        ipc.on('piHostname', function(hostname) {
            if(hostname) {
                $('#pi-status').removeClass('label-danger').addClass('label-success').text(hostname + " connected");
            }
        });

        ipc.on('piDisconnect', function() {
            $('#pi-status').removeClass('label-success').addClass('label-danger').text("Raspberry pi not connected");
        })

        ipc.on('videos', function(videos) {
            console.log(JSON.stringify(videos));
            for(path in videos) {
                videoInfo = videos[path];
                videoInfo['path'] = path;
                var template = $('#videoTemplate').html();
                var video = Handlebars.compile(template);
                $('#videos').append(video(videoInfo));
                var videoContainer = document.querySelector('#videos');
                var masonry = new Masonry( videoContainer, {
                  itemSelector: '.poster',
                  gutter: 20,
                });
                masonry.layout();
            }
        });

        $(function() {
            $(document).on('click', '.poster', function() {
                var videoPath = $(this).attr('id');
                ipc.send('stream', videoPath);
            });
        })


    </script>
    
</head>
<body>
    <div style="margin:20px">
        <div id="container">
        <div class="row">
            <div class="col-lg-10">
                <h4>Piast</h4>
            </div>
            <div class="col-lg-2">
                <span id="pi-status" class="label label-danger pull-right">Raspberry pi not connected</span>
            </div>
        </div>
            <div id="videos">
            </div>
        </div>
    </div>
</body>
</html>

